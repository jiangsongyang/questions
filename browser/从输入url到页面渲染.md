# 进程职责

1. 浏览器进程
   负责交互、子进程管理和文件储存等功能
2. 网络进程
   负责向渲染进程和浏览器进程提供网络下载功能
3. 渲染进程
   将网络进程下载的 html css js 解析成浏览器展示的页面

   由于渲染进程的资源都是从网络进程中获取的，有可能有安全漏洞，所以渲染进程运行在沙箱里

# 步骤

1. 浏览器进程接受用户输入的 url 判断是否是搜索内容 或者 请求的 url
   如果是关键字 就合成新的 url 进行请求

2. 执行 beforeunload 钩子

3. 标签页面图标进入加载状态， 但是此时的页面显示是之前的页面

![alt 属性文本](https://static001.geekbang.org/resource/image/fa/30/fad33fc7c5f2bdf4e20cac7691484130.png)

4. 通过 ipc 将 url 请求发送到网络进程

5. 网络进程查找本地缓存，如果有就直接返回，没有就就进入网络请求流程

6. 进行 DNS 解析， 利用 ip 地址和服务器建立 TCP 链接，浏览器构建请求行，请求头等信息，并把 cookie 放到请求头中

7. 接受相应信息，判断是否需要重定向

8. 根据 content-type 决定处理方式。
   如果是文件，就开始处理预览或者下载。
   如果是 html 就开始渲染流程

9. 提交文档给渲染进程，建立管道，更新浏览器界面状态，包括了安全状态、地址栏的 URL、前进后退的历史状态，并更新 Web 页面。

![](https://static001.geekbang.org/resource/image/d3/b8/d3c5a6188b09b5b57af439005ae7dfb8.png)

10. 解析 html 构建 DOM Tree

11. 解析 css 转换为 styleSheets。将样式表中的值标准化

![](https://static001.geekbang.org/resource/image/12/60/1252c6d3c1a51714606daa6bdad3a560.png)

12. 计算每个 dom 节点的具体样式（computed style）

13. 创建布局树(排除一些不可见节点 如 head meta等)， 计算布局

14. 进行分层，生成图层树
    什么样的节点会被分层 ？ 
    1. 拥有层叠上下文属性的元素会被提升为单独的一层。（明确定位属性的元素、定义透明属性的元素、使用 CSS 滤镜的元素等，都拥有层叠上下文属性。）
    2. 需要剪裁（clip）的地方也会被创建为图层。


15. 图层绘制，执行待绘制列表

16. 栅格化（raster）操作

17. 合成和显示